# 排错必备工具汇总

## 1. 系统状态检查工具

### 1.1 CPU 相关工具

| 命令 | 功能描述 | 使用场景 | 示例 |
|------|---------|---------|------|
| `top` | 实时查看系统CPU、内存使用情况 | CPU 使用率高、负载异常 | `top -c`（显示命令详情） |
| `uptime` | 查看系统负载和运行时间 | 系统负载监控 | `uptime` |
| `vmstat` | 虚拟内存统计，包括CPU使用 | 系统性能分析 | `vmstat 1`（每秒刷新） |
| `mpstat` | 多处理器状态监控 | 多核CPU负载分析 | `mpstat -P ALL 1` |
| `pidstat` | 进程级CPU使用统计 | 定位高CPU进程 | `pidstat -u 1` |

### 1.2 内存相关工具

| 命令 | 功能描述 | 使用场景 | 示例 |
|------|---------|---------|------|
| `free` | 查看内存和交换分区使用情况 | 内存不足、内存泄漏 | `free -h`（人类可读格式） |
| `vmstat` | 虚拟内存统计，包括内存使用 | 内存使用分析 | `vmstat 1` |
| `pmap` | 查看进程的内存映射 | 进程内存使用分析 | `pmap -x <PID>` |
| `valgrind` | 内存调试和内存泄漏检测 | 内存泄漏排查 | `valgrind --leak-check=full ./program` |
| `ps` | 查看进程状态，包括内存使用 | 进程内存使用排序 | `ps aux --sort=-%mem` |

### 1.3 磁盘相关工具

| 命令 | 功能描述 | 使用场景 | 示例 |
|------|---------|---------|------|
| `df` | 查看文件系统磁盘空间使用情况 | 磁盘空间不足 | `df -h` |
| `du` | 查看目录或文件的磁盘使用情况 | 定位大文件/目录 | `du -sh *`（查看当前目录各文件大小） |
| `iostat` | 磁盘IO统计 | 磁盘IO过高 | `iostat -x 1` |
| `iotop` | 实时IO监控，类似top | 定位高IO进程 | `iotop` |
| `lsblk` | 查看块设备信息 | 磁盘分区和挂载 | `lsblk -f`（显示文件系统类型） |
| `fsck` | 文件系统检查和修复 | 文件系统损坏 | `fsck /dev/sda1`（卸载后执行） |

### 1.4 网络相关工具

| 命令 | 功能描述 | 使用场景 | 示例 |
|------|---------|---------|------|
| `ping` | 测试网络连通性 | 网络不通、丢包 | `ping -c 4 google.com` |
| `traceroute` | 跟踪数据包路由路径 | 网络延迟、路由问题 | `traceroute google.com` |
| `netstat` | 网络状态统计 | 端口占用、连接状态 | `netstat -tuln`（查看监听端口） |
| `ss` |  Socket 统计，替代netstat | 端口占用、连接状态 | `ss -tuln` |
| `ifconfig` | 查看和配置网络接口 | 网络接口状态 | `ifconfig` |
| `ip` | 网络配置工具，替代ifconfig | 网络接口、路由配置 | `ip addr` |
| `tcpdump` | 网络数据包捕获和分析 | 网络故障分析 | `tcpdump -i eth0 port 80` |
| `nc` | 网络工具，可用于端口测试 | 端口连通性测试 | `nc -zv 127.0.0.1 80` |

## 2. 日志分析工具

### 2.1 系统日志

| 命令 | 功能描述 | 使用场景 | 示例 |
|------|---------|---------|------|
| `tail` | 查看文件尾部内容 | 实时查看日志 | `tail -f /var/log/messages` |
| `grep` | 文本搜索工具 | 日志关键字搜索 | `grep "error" /var/log/messages` |
| `less` | 分页查看文件内容 | 查看大日志文件 | `less /var/log/messages` |
| `journalctl` | 查看systemd日志 | 系统服务日志 | `journalctl -u nginx.service` |
| `dmesg` | 查看内核环缓冲区信息 | 硬件故障、内核错误 | `dmesg | grep "error"` |

### 2.2 日志分析工具

| 工具 | 功能描述 | 使用场景 | 示例 |
|------|---------|---------|------|
| `ELK Stack` | Elasticsearch + Logstash + Kibana | 集中式日志管理和分析 | 企业级日志平台 |
| `Graylog` | 日志管理和分析平台 | 集中式日志管理 | 企业级日志平台 |
| `rsyslog` | 系统日志服务 | 日志收集和转发 | 配置日志集中管理 |
| `logrotate` | 日志文件轮转管理 | 防止日志文件过大 | 配置日志轮转策略 |

## 3. 进程管理工具

| 命令 | 功能描述 | 使用场景 | 示例 |
|------|---------|---------|------|
| `ps` | 查看进程状态 | 进程状态监控 | `ps aux` |
| `pstree` | 以树状结构显示进程 | 进程关系分析 | `pstree -p`（显示PID） |
| `kill` | 终止进程 | 终止异常进程 | `kill -9 <PID>`（强制终止） |
| `killall` | 按进程名终止进程 | 终止同名进程组 | `killall nginx` |
| `pgrep` | 根据条件查找进程 | 查找特定进程 | `pgrep nginx` |
| `pkill` | 根据条件终止进程 | 终止特定进程 | `pkill nginx` |
| `systemctl` | 系统服务管理 | 服务状态和控制 | `systemctl status nginx` |

## 4. 配置检查工具

| 命令 | 功能描述 | 使用场景 | 示例 |
|------|---------|---------|------|
| `cat` | 查看文件内容 | 查看配置文件 | `cat /etc/nginx/nginx.conf` |
| `diff` | 比较文件差异 | 配置文件变更分析 | `diff old.conf new.conf` |
| `md5sum` | 计算文件MD5哈希值 | 配置文件完整性检查 | `md5sum /etc/passwd` |
| `grep` | 文本搜索工具 | 配置文件关键字搜索 | `grep "listen" /etc/nginx/nginx.conf` |
| `find` | 查找文件 | 查找配置文件 | `find /etc -name "*.conf"` |

## 5. 安全检查工具

| 命令 | 功能描述 | 使用场景 | 示例 |
|------|---------|---------|------|
| `iptables` | 防火墙配置 | 防火墙规则检查 | `iptables -L -n` |
| `ufw` | 简单防火墙管理 | 防火墙状态检查 | `ufw status` |
| `fail2ban-client` | 防暴力破解工具 | 登录失败监控 | `fail2ban-client status` |
| `ps` | 查看进程状态 | 可疑进程检测 | `ps aux | grep suspicious` |
| `netstat/ss` | 网络状态统计 | 可疑网络连接 | `netstat -tulnp` |
| `last` | 查看用户登录历史 | 异常登录检测 | `last -n 10` |
| `w` | 查看当前登录用户 | 当前用户监控 | `w` |

## 6. 性能分析工具

| 命令/工具 | 功能描述 | 使用场景 | 示例 |
|-----------|---------|---------|------|
| `perf` | Linux 性能分析工具 | 系统性能分析 | `perf top` |
| `strace` | 跟踪进程系统调用 | 进程行为分析 | `strace -p <PID>` |
| `ltrace` | 跟踪进程库函数调用 | 库函数调用分析 | `ltrace -p <PID>` |
| `blktrace` | 块设备I/O跟踪 | 磁盘I/O分析 | `blktrace -d /dev/sda -o - | blkparse -i -` |
| `netstat -s` | 网络统计信息 | 网络性能分析 | `netstat -s` |

## 7. 远程管理工具

| 工具 | 功能描述 | 使用场景 | 示例 |
|------|---------|---------|------|
| `ssh` | 安全远程登录 | 远程服务器管理 | `ssh user@hostname` |
| `scp` | 安全文件传输 | 远程文件复制 | `scp file.txt user@hostname:/path/` |
| `rsync` | 远程同步工具 | 文件同步和备份 | `rsync -avz local/ user@hostname:remote/` |
| `telnet` | 远程终端协议 | 端口连通性测试 | `telnet hostname 80` |
| `ssh-keygen` | 生成SSH密钥 | 密钥认证配置 | `ssh-keygen -t rsa` |

## 8. 监控工具

| 工具 | 功能描述 | 使用场景 | 特点 |
|------|---------|---------|------|
| `Nagios` | 企业级监控系统 | 全面系统监控 | 功能强大，配置复杂 |
| `Zabbix` | 企业级监控解决方案 | 网络、服务器监控 | 图形界面友好，功能丰富 |
| `Prometheus` | 时序数据库监控系统 | 容器和微服务监控 | 适合云原生环境 |
| `Grafana` | 数据可视化工具 | 监控数据展示 | 与多种数据源集成 |
| `ELK Stack` | 日志管理和分析 | 日志集中管理 | 适合大规模日志分析 |
| `Netdata` | 实时性能监控 | 实时系统监控 | 轻量级，可视化效果好 |

## 9. 工具使用建议

### 9.1 工具选择原则

1. **根据场景选择**：不同的故障场景选择合适的工具
2. **掌握核心工具**：熟练掌握最常用的命令和工具
3. **组合使用**：多个工具配合使用，获取更全面的信息
4. **自动化**：对于重复的排错任务，编写脚本自动化

### 9.2 工具使用技巧

1. **命令参数**：熟悉常用命令的参数，提高使用效率
2. **管道组合**：使用管道（`|`）组合多个命令
3. **重定向**：使用重定向（`>`、`>>`）保存输出
4. **后台运行**：使用后台运行（`&`）执行长时间任务
5. **别名设置**：为常用命令组合设置别名

### 9.3 工具学习资源

- 命令手册：`man <命令>` 或 `info <命令>`
- 在线文档：各工具的官方文档
- 实践经验：通过实际排错积累使用经验
- 社区资源：论坛、博客、视频教程

## 10. 总结

掌握这些排错工具是 Linux 运维工程师的必备技能。不同的工具适用于不同的场景，灵活运用这些工具可以大大提高排错效率。在实际工作中，应根据具体的故障场景选择合适的工具，并通过实践不断积累经验，形成自己的排错工具链。

同时，随着技术的发展，新的工具不断涌现，运维工程师应保持学习的态度，及时了解和掌握新的工具和技术，不断提升自己的排错能力。